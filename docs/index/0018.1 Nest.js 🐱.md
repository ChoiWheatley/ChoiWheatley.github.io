---
aliases: 
tags: 
description:
title: 0018.1 Nest.js ğŸ±
created: 2023-11-10T14:57:24
updated: 2024-12-06T18:11:15
---
- [[0018 Javascript â˜•ï¸]]
- [ë…¸ë§ˆë“œ ì½”ë” nest.js](https://nomadcoders.co/nestjs-fundamentals)
	- [ë…¸ë§ˆë“œ ì½”ë” typescript](https://nomadcoders.co/typescript-for-beginners)
- [NestJSë¡œ ë°°ìš°ëŠ” ë°±ì—”ë“œ í”„ë¡œê·¸ë˜ë°](https://wikidocs.net/book/7059)
- [ê³µì‹ë¬¸ì„œ](https://docs.nestjs.com)
- [nestjs and postgresql - CRUD tutorial](https://medium.com/simform-engineering/nestjs-and-postgresql-a-crud-tutorial-32aa78778752)
___

## Related Topics

- [[oauth2 {nest.js} {passport}]]
- [[0018.3 jest testing framework for Node.js]]
- [[Decorator - {nestjs}]]
- [[(TODO) RxJS]]
- [[0018.4 TypeORM ğŸ’¾]]
- [[(TODO) Model-View-Controller ë¥¼ ì‚¬ìš©í•œ í’€ìŠ¤íƒ ì„œë²„ ë§Œë“¤ê¸° {nest.js}]]
- [[(TODO) Pagination in {Nest.js}]]
- [[(TODO) Domain Driven Hexagon with {nest.js}]]

## Help Centre

- [[NestJSê°€ RDSì— ì—°ê²°í•  ìˆ˜ ì—†ì–´ìš”.help]]

## Packages

- [[multer ì´ë¯¸ì§€ ì—…ë¡œë“œ ëª¨ë“ˆ.nest.node feat.mutipart-form-data]]

## Overview

- NestJS ì„¤ì¹˜ë²•: 
	- `npm i -g @nestjs/cli`
	- `nest new project-name`
	- `nest start`
- í•µì‹¬ íŒŒì¼ êµ¬ì¡°
	- `app.controller.ts`: ì»¨íŠ¸ë¡¤ëŸ¬ëŠ” ë¼ìš°í„°ì„
	- `app.controller.spec.ts`: specì´ë¼ëŠ” ì´ë¦„ì€ ìœ ë‹›í…ŒìŠ¤íŠ¸ë¥¼ ì˜ë¯¸í•¨.
	- `app.serivce.ts`: ì„œë¹„ìŠ¤ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì— ì˜í•´ í˜¸ì¶œë˜ëŠ” ë‹¤ì–‘í•œ ì½œë°±ë“¤ì„ ë‹´ì•„ë†“ëŠ” íŒŒì¼
	- `app.module.ts`: í”„ë¡œì íŠ¸ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ê³³
	- `main.ts`: ì—”íŠ¸ë¦¬íŒŒì¼, `app` ìƒì„±í•¨
- ë¹ ë¥´ê²Œ ì»´íŒŒì¼í•˜ê³  ì‹¤í–‰ì‹œí‚¤ë ¤ë©´... `npm run start -- -b swc`
- hot reloadingì„ ìì²´ì ìœ¼ë¡œ ì§€ì›í•œë‹¤ : `npm run start:dev`
- CRUD ê°€ëŠ¥í•œ ëª¨ë“ˆ (controller, module, service, dto, entity)ì„ ë§Œë“œëŠ” ëª…ë ¹ì–´ëŠ” `nest g res <resource-name>`, ë‹¤ìŒ ì„¸ ëª…ë ¹ì–´ë¥¼ ì¼ê´„ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ëŠ”ë“¯.
	- `nest g controller`
	- `nest g service`
	- `nest g module`

### Controllers

- request & responseë¥¼ ì²˜ë¦¬í•˜ëŠ” ë ˆì´ì–´.
- ìƒˆ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ë§Œë“œëŠ” ëª…ë ¹ì–´ëŠ” `nest g controller <name>`ì´ë‹¤. 
- í´ë˜ìŠ¤ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ `@Controller(<path>)`ê°€ ë‹¬ë ¤ìˆë‹¤.
- ë©”ì„œë“œë“¤ì´ ê°ê°ì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ì‘ìš©í•˜ê¸° ìœ„í•´ì„  `@GET([subpath])`ì™€ ê°™ì€ HTTP ë©”ì„œë“œ ì´ë¦„ì˜ ì–´ë…¸í…Œì´ì…˜ì„ ë‹¬ì•„ì•¼ í•œë‹¤.
- ì„±ê³µì ìœ¼ë¡œ ì‘ë‹µì„ ë°˜í™˜í•´ì•¼í•  ë•Œ ê¸°ë³¸ê°’ì€ 200ì´ê³ , POSTì¼ ê²½ìš° 201ì´ë‹¤. ì´ë¥¼ ì˜¤ë²„ë¼ì´ë“œí•˜ê¸° ìœ„í•´ì„  `@HttpCode(<number>)` ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•´ì•¼ í•œë‹¤. 
	- ì—ëŸ¬ statusë¥¼ ë°˜í™˜í•  ê²½ìš° ì˜ˆì™¸ë¥¼ throwí•˜ë¼ë˜ë°?
	- ì•„ë¬´ statusë‚˜ ë°˜í™˜í•˜ê³  ì‹¶ì„ë• expressì˜ ì½”ë“œë¥¼ ì‚¬ìš©í•˜ë¼ê³ ..
___ 
- **[Request Object](https://docs.nestjs.com/controllers#request-object)**
	- Path ì¸ìëŠ” `@Get(:id)` ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ ì •ì˜í•˜ê³  íŒŒì‹±ëœ ì¸ìëŠ” ë©”ì„œë“œ ì¸ìë¡œ ë“¤ì–´ì˜¨ë‹¤.

	```ts
	@Get(':id')
	fineOne(@Param() params: any): string {
		return param.id + 'cat';
	}
	``` 

	- request ì„¸ë¶€ì‚¬í•­ì„ ì•Œê¸° ìœ„í•´ì„  ë©”ì„œë“œ íŒŒë¼ë©”í„° ì•ì— `@Req()` ë°ì½”ë ˆì´í„°ë¥¼ ë¶™ì´ë¼ê³ ! 

	```ts
	import { Request } from 'express';
	@Get()
	fineOne(@Req() request: Request): string {
		return request.body;
	}
	``` 

- ì´ë ‡ê²Œ ë©”ì„œë“œ íŒŒë¼ë©”í„°ë¡œ ë„£ì„ ìˆ˜ ìˆëŠ” ë°ì½”ë ˆì´í„°ë“¤ë¡œëŠ” `@Res`, `@Next`, `@Session`, `@Param`, `@Body`, `@Query`, `@Headers` ë“±ì´ ìˆê³  [ë‹¤ìŒ ë§í¬](https://docs.nestjs.com/controllers#request-object)ë¥¼ ì°¸ê³ í•˜ì‹œì˜¤.

#### `@Param`

ë™ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆëŠ” Pathì¸ì. `/cat/1`ì—ì„œì˜ `1`ê³¼ ê°™ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ë° ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤. ë§¤ê°œ ë³€ìˆ˜ê°€ ìˆëŠ” ê²½ë¡œëŠ” ì •ì  ê²½ë¡œ ë’¤ì— ì„ ì–¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤. ì´ê²ƒì€ ë§¤ê°œ ë³€ìˆ˜í™”ëœ ê²½ë¡œê°€ ì •ì  ê²½ë¡œë¡œ í–¥í•˜ëŠ” íŠ¸ë˜í”½ì„ ê°€ë¡œì±„ëŠ” ê²ƒì„ ë°©ì§€í•©ë‹ˆë‹¤.

#### `@Query`

`?` ì´í›„ì— ë‚˜ì˜¤ê³  `&`ë¡œ ë¶„ë¦¬ëœ ì¸ìë“¤ì„ ì˜ë¯¸. `key=value` ìŒìœ¼ë¡œ ì´ë£¨ì–´ì ¸ ìˆë‹¤.

- ì˜ˆì‹œ: `/cat?key1=value1&key2=value2`
-  deferred responseë¥¼ ë¦¬í„´í•´ë„ ëœë‹¤ê³ . Promise íƒ€ì… ê°ì²´ë¥¼ ë¦¬í„´í•˜ê²Œ ë˜ë©´ [[#RxJS]]ì˜ observable streamìœ¼ë¡œ ë¦¬í„´ì´ ë˜ê³ , ìŠ¤íŠ¸ë¦¼ì´ ëë‚ ê²½ìš° í•´ë‹¹ ì†ŒìŠ¤ì— ì•Œë¦¼ì´ ê°„ë‹¤ê³ ëŠ” í•˜ëŠ”ë° ë­” ì†Œë¦°ì§€ ì˜ ëª¨ë¥´ê² ìŒ.

___
- **[Request Payloads](https://docs.nestjs.com/controllers#request-payloads)**
	- DTO, Data Transfer Objectë¼ê³  ë¶ˆë¦¬ìš°ëŠ”, ë„¤íŠ¸ì›Œí¬ ì „ì†¡ì„ ìœ„í•´ ì¡´ì¬í•˜ëŠ” ê°ì²´íƒ€ì…ì€ í´ë˜ìŠ¤ë¡œ ì •ì˜ê°€ ë˜ì–´ìˆë‹¤ê³ . DTO í´ë˜ìŠ¤ ë©¤ë²„ë“¤ì€ ì§ë ¬í™” ê°€ëŠ¥í•œ íƒ€ì…ë§Œ ë“¤ì–´ì˜¬ ìˆ˜ ìˆë‚˜?
	- [[express.js]]ì—ì„œ POSTìš”ì²­ì— ëŒ€í•œ ìš”ì²­ì˜ bodyë¥¼ ëœ¯ì–´ ì›í•˜ëŠ” í‚¤ê°’ë“¤ì„ ì§ì ‘ íšë“í–ˆë‹¤ë©´, Nest.jsëŠ” DTO ê°ì²´ë¥¼ ì¸ìë¡œ ë°›ì•„ì™€ ê³§ë°”ë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.
	- `@Post() create(@Body() createCatDto: CreateCatDto) {...}`
- app.module.ts íŒŒì¼ì— ë‚´ê°€ ì •ì˜í•œ ì»¨íŠ¸ë¡¤ëŸ¬ë“¤ì„ `@Module()` ë°ì½”ë ˆì´í„° ì•ˆì— ë„£ì„ ìˆ˜ ìˆë‹¤.

### [Providers](https://docs.nestjs.com/providers)

ì˜ì¡´ì„± ì£¼ì…ë  ìˆ˜ ìˆëŠ” ë‹¤ì–‘í•œ í´ë˜ìŠ¤ë“¤ì´ë‹¤. ëŒ€í‘œì ìœ¼ë¡œ Service, Repository, Factory, Helper, Middlewareê°€ ìˆë‹¤. ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ì²˜ë¦¬í•  ìˆ˜ ì—†ëŠ” ë³µì¡í•œ ì‘ì—…ì„ Providerë“¤ì—ê²Œ ë„˜ê²¨ì£¼ëŠ” ì˜ˆì‹œë¥¼ ë³´ì—¬ì£¼ê³  ìˆë‹¤.

**Inversion of Control**

<https://en.wikipedia.org/wiki/Inversion_of_control>

ì›ë˜ëŠ” ìœ ì €ê°€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œë¥¼ í˜¸ì¶œí•˜ì§€ë§Œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì½”ë“œê°€ ì¸í„°í˜ì´ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ ì € ì½”ë“œë¥¼ í˜¸ì¶œí•  ìˆ˜ ìˆê²Œ ë§Œë“œëŠ” íŒ¨í„´ì„ IoCë¼ê³  ë¶€ë¥¸ë‹¤.

Dependency Injectionì´ë¼ê³ , ìƒì„±ì íƒ€ì„ì— ì˜ì¡´ì„± Providerë¥¼ ì£¼ì…í•˜ëŠ” ê³¼ì •ì„ ì˜ë¯¸. ì•„ë˜ì˜ ì½”ë“œì˜ Providerì¸ `CatsService`ëŠ” `@Injectable` ë°ì½”ë ˆì´í„°ë¥¼ ë‹¬ê³ ìˆê¸° ë•Œë¬¸ì— ì»¨íŠ¸ë¡¤ëŸ¬ì˜ ìƒì„±íƒ€ì„ì— ì£¼ì…ë  ìˆ˜ ìˆë‹¤.

```ts
// interfaces/cats.interface.ts
export interface Cat {
	name: string;
	age: number;
	breed: string;
}

// cats/cats.service.ts
@Injectable()
export class CatsService {
	private readonly cats: Cat[] = [];
	create(cat: Cat) {
		this.cats.push(cat);
	}
	findall(): Cat[] {
		return this.cats
	}
}

// cats/cats.controller.ts
@Controller('cats')
export class CatsController {
	/**
	 * ìë™ìœ¼ë¡œ ì£¼ì…ë˜ëŠ” CatsService
	 */
	constructor(private catsService: CatsService) {}

	@Post()
	async create(@Body() createCatDto: CreateCatDto) {
		this.catsService.create(createCatDto)
	}

	@Get()
	async findAll(): Promise<Cat[]> {
		return this.catsService.findAll();
	}
}
```

ìƒì„±ìì— ì˜ì¡´ì„±ì„ ë„£ê³ ì‹¶ì§€ ì•Šë‹¤ë©´ [Property-based injection](https://docs.nestjs.com/providers#property-based-injection)ì„ ì°¸ê³ .

### [Modules](https://docs.nestjs.com/modules)

ê°ê°ì˜ ë„ë©”ì¸ë“¤ (users, cats, posts, comments, ...)ì€ ê°ê°ì˜ appìœ¼ë¡œ ê´€ë¦¬ëœë‹¤. ì´ë•Œ appì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ëŠ” ì½”ë“œë“¤ì˜ ì§‘í•©ì„ ëª¨ë“ˆì´ë¼ê³  ë¶€ë¥¸ë‹¤. `nest g module <module-name>` CLI ëª…ë ¹ì–´ë¡œ ìƒˆ ëª¨ë“ˆ ìƒì„±ì´ ê°€ëŠ¥í•˜ë‹¤. ê·¸ë¦¬ê³  ë£¨íŠ¸ëª¨ë“ˆì— importë¥¼ í•´ì•¼í•œë‹¤.

`exports` ì†ì„±ìœ¼ë¡œ ëª¨ë“ˆ ë‚´ providerë¥¼ ë‹¤ë¥¸ ëª¨ë“ˆì—ì„œë„ ì‚¬ìš©í•  ìˆ˜ ìˆê²Œ ë§Œë“ ë‹¤.

```ts
@Module({
	controllers: [CatsController],
	providers: [CatsService],
	exports: [CatsService]
})
export class CatsModule {}
```

`@Global` ì–´ë…¸í…Œì´ì…˜ ë‹¬ë©´ providersë¥¼ ë‹¤ë¥¸ ëª¨ë“  ëª¨ë“ˆì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

### [Middleware](https://docs.nestjs.com/middleware)

express.jsì˜ ë¯¸ë“¤ì›¨ì–´ì˜ ìŠ¤í‚´ì„ ê³ ìŠ¤ë€íˆ ë”°ë¼ê°€ê³  ìˆë‹¤. ë‹¨ìˆœ í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ `next()` ë¥¼ ì‚¬ìš©, ë‹¤ìŒ ë¯¸ë“¤ì›¨ì–´ë¡œ ìš”ì²­ì„ ì „ë‹¬í•  ìˆ˜ë„ ìˆìœ¼ë©°, `NestMiddleware` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ì— ì˜ì¡´ì„± ì£¼ì…ì„ í•  ìˆ˜ë„ ìˆë‹¤.

```ts
// logger.middleware.ts
@Injectable()
export class LoggerMiddleware implements NestMiddleware {
	use(req: Request, res: Response, next: NextFunction) {
		console.log('reqest...');
		next();
	}
}

// app.module.ts
@Module({
	imports: [CatsModule],
})
export class AppModule implements NestModule {
	configure(consumer: MiddlewareConsumer) {
		consumer
			.apply(LoogerMiddleware)
			.forRoutes('cats');
	}
}
```

`consumer.forRoutes` ì˜ ì¸ìë¡œ ì¢€ ë” êµ¬ì²´ì ì¸ path, method, ì‹¬ì§€ì–´ëŠ” controllerë¥¼ ì„¤ì •í•  ìˆ˜ë„ ìˆë‹¤.

### [Exception Filters](https://docs.nestjs.com/exception-filters) (ì´í•´ë¶€ì¡±)

> Nestì—ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ ì „ì²´ì—ì„œ ì²˜ë¦¬ë˜ì§€ ì•Šì€ ëª¨ë“  ì˜ˆì™¸ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì˜ˆì™¸ ê³„ì¸µì´ ë‚´ì¥ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì˜ˆì™¸ê°€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ ì²˜ë¦¬ë˜ì§€ ì•Šìœ¼ë©´ ì´ ê³„ì¸µì—ì„œ ì˜ˆì™¸ë¥¼ í¬ì°©í•˜ì—¬ ì ì ˆí•œ ì‚¬ìš©ì ì¹œí™”ì ì¸ ì‘ë‹µì„ ìë™ìœ¼ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.

```typescript
import { ExceptionFilter, Catch, ArgumentsHost, HttpException } from '@nestjs/common';
import { Request, Response } from 'express';

@Catch(HttpException)
export class HttpExceptionFilter implements ExceptionFilter {
  catch(exception: HttpException, host: ArgumentsHost) {
    const ctx = host.switchToHttp();
    const response = ctx.getResponse<Response>();
    const request = ctx.getRequest<Request>();
    const status = exception.getStatus();

    response
      .status(status)
      .json({
        statusCode: status,
        timestamp: new Date().toISOString(),
        path: request.url,
      });
  }
}
```

- `getRequest<Request>`ì™€ `getResponse<Response>`ë¥¼ ì‚¬ìš©, ì˜ˆì™¸ ì•ˆì—ì„œë„ ìš”ì²­ê³¼ ì‘ë‹µ ê°ì²´ì˜ ì°¸ì¡°ë¥¼ ì–»ì–´ì˜¬ ìˆ˜ ìˆë‹¤.
- `exception`ì€ í˜„ì¬ ì²˜ë¦¬ì¤‘ì¸ ì˜ˆì™¸ê°ì²´
- `host`ëŠ” `ArgumentHost`ê°ì²´ë¡œ, ì•„ì§ ì˜ ëª¨ë¥´ê²ƒë‹¤
	- HTTP ì˜ˆì™¸ ë¿ë§Œ ì•„ë‹ˆë¼ ë‹¤ì–‘í•œ ì˜ˆì™¸ (MSA, WebSocket)ì— ëŒ€ì‘í•˜ê¸° ìœ„í•´ `ArgumentHost`ë¥¼ ì‚¬ìš©í•œë‹¤ëŠ” ì ë§Œí¼ì€ ì•Œê³  ë„˜ì–´ê°€ì

- í•„í„° ì—°ê²°ë²•: ì»¨íŠ¸ë¡¤ëŸ¬ (í˜¹ì€ ë©”ì„œë“œ)(í˜¹ì€ `bootstrap` ì•ˆì—)ì˜ ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ `@UseFilters()`ë¥¼ ì¶”ê°€í•œë‹¤. 

```ts
@Post()
@UseFilters(HttpExceptionFilter)
async create(@Body() createCatDto: CreateCatDto) {
	throw new ForbiddenException();
}
```

### [Pipes](https://docs.nestjs.com/pipes)

íŒŒì´í”„ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ê°€ ë¼ìš°íŒ…ì„ í•˜ê¸° ì „ ë‘ ê°€ì§€ ì—­í• ì„ ìˆ˜í–‰í•œë‹¤.

1. ë°ì´í„° ë³€í™˜ (ì˜ˆì‹œ. string âŸ¶ number)
2. ë°ì´í„° ê²€ì¦

ëª¨ë“  `PipeTransform` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  `@Injectable()` ì–´ë…¸í…Œì´ì…˜ì„ ê°–ê³ ìˆëŠ” í´ë˜ìŠ¤ëŠ” Pipeì´ë‹¤.

path variableì„ ì›í•˜ëŠ” íƒ€ì…ìœ¼ë¡œ íŒŒì‹±í•´ì•¼í•  ê²½ìš°, ì˜ˆë¥¼ ë“¤ì–´ ì¸ìì— ë“¤ì–´ì˜¬ `@Param`ì— `ParseXXXPipe`ë¥¼ ë„£ì–´ì£¼ë©´ ëœë‹¤.

```ts
@Get(':id')
async findOne(@Param('id', ParseIntPipe) id: number) {
	return this.catsService.findOne(id);
}
```

path variableë§Œ ë˜ëƒ? query parameterë„ ëœë‹¤!

```ts
@Get()
async findOne(@Query('id'), ParseIntPipe) id: number) {
	...
}
```

íŒŒì‹±ì— ì‹¤íŒ¨í•œ ê²½ìš° (ì˜ˆë¥¼ ë“¤ì–´ `GET cats/hello`ê°€ ë“¤ì–´ì˜¨ ê²½ìš°) ì˜ˆì™¸ë¥¼ ë˜ì§„ë‹¤. ê·¸ ì˜ˆì™¸ëŠ” ìœ„ì—ì„œ ì„¤ëª…í•œ [[#[Exception Filters](https <//docs.nestjs.com/exception-filters>) (ì´í•´ë¶€ì¡±)|Exception Filter]]ì—ì„œ ì²˜ë¦¬ë˜ì–´ ì—ëŸ¬ ë©”ì‹œì§€ë¥¼ ì‘ë‹µí•˜ê²Œ ëœë‹¤.

- [?] ê·¸ë˜ë„ ë©”ì„œë“œ ì„ ì–¸ ìˆœì„œê°€ ë¬¸ì œê°€ ë  ê²ƒ ê°™ì€ë°? `@Get('cat/:id')`ì™€ `@Get('cat/breed')` ì´ ìˆœì„œë¡œ ë¼ìš°íŒ…ì„ ì²˜ë¦¬í•´ë²„ë¦¬ë©´ ì „ë¶€ ì²«ë²ˆì§¸ ì»¨íŠ¸ë¡¤ëŸ¬ë¡œ ë“¤ì–´ê°ˆ ê²ƒì´ê³  ì˜ˆì™¸ê°€ ë°œìƒí•  ê²ƒì´ë‹¤.

	```ts
	// not ok
	@Get(':id')
	findOne(@Param('id', ParseIntPipe) id: number): string {
	  return `meowingtone #${id}`;
	}
	
	@Get('breed')
	findBreed(): string {
	  return 'you requested breed!';
	}
	```

	```ts
	// ok
	@Get('breed')
	findBreed(): string {
	  return 'you requested breed!';
	}

	@Get(':id')
	findOne(@Param('id', ParseIntPipe) id: number): string {
	  return `meowingtone #${id}`;
	}
	```

ë§Œì•½ì— íŒŒì´í”„ë¥¼ í†µí•´ì„œ ë³€í™˜í•´ì•¼ í•˜ëŠ” íƒ€ì…ì´ ê¸°ë³¸íƒ€ì…ì´ ì•„ë‹ˆë¼ë©´? => DTO Validationì„ ì‚¬ìš©í•˜ë©´ ëœë‹¤. [[DTO Validation using class-validator {NestJS}]]

### [Guards](https://docs.nestjs.com/guards)

guardëŠ” `@Injectable` ì–´ë…¸í…Œì´ì…˜ì„ ê°€ì§€ê³  `CanActivate` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ í´ë˜ìŠ¤ë¥¼ ì˜ë¯¸í•œë‹¤.

guardsëŠ” express.js ë¯¸ë“¤ì›¨ì–´ì˜ ë‹¨ì ì¸ `next`ê°€ ëˆ„êµ¬ì¸ì§€ ëª¨ë¥¸ë‹¤ëŠ” íŠ¹ì§•ì„ `ExecutionContext` ì¸ìŠ¤í„´ìŠ¤ë¥¼ í†µí•´ ê·¹ë³µí•  ìˆ˜ ìˆë‹¤ê³ .

ê°€ì¥ ëŒ€í‘œì ì¸ ì‚¬ìš©ì‚¬ë¡€ëŠ” ì—­ì‹œ ì‚¬ìš©ì ì¸ê°€ì´ë‹¤. [nestjs.com/security/authentication](https://docs.nestjs.com/security/authentication) ì‚¬ìš©ì ì¸ê°€ì— ëŒ€í•œ ë¡œì§ì„ ë§Œë“¤ì–´ ì „ì—­ì ìœ¼ë¡œ or ì»¨íŠ¸ë¡¤ëŸ¬ or ë©”ì„œë“œ ìŠ¤ì½”í”„ì—ì„œ ë™ì‘í•˜ë„ë¡ ë§Œë“¤ ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤.

`ExecutionContext` ê°ì²´ëŠ” `ArgumentHost`ë¥¼ ìƒì†í–ˆê¸° ë•Œë¬¸ì— requestê°ì²´ì™€ response ê°ì²´ë¥¼ ë°›ì•„ì˜¬ ìˆ˜ ìˆë‹¤.

```typescript
import { Injectable, CanActivate, ExecutionContext } from '@nestjs/common';
import { Observable } from 'rxjs';

@Injectable()
export class AuthGuard implements CanActivate {
  canActivate(
    context: ExecutionContext,
  ): boolean | Promise<boolean> | Observable<boolean> {
    const request = context.switchToHttp().getRequest();
	/**
	 * ExecutionContextì—ì„œ request ì •ë³´ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤. 
	 * í—¤ë”ì— ë‹´ê¸´ í† í°ì„ validateí•  ìˆ˜ë„ ìˆë‹¤. ê²°ê³¼ëŠ” ë™ê¸°ì ìœ¼ë¡œ
	 * (Promise), í˜¹ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ (Observable), í˜¹ì€ ê·¸ ì¦‰ì‹œ
	 * (boolean) ë¦¬í„´í•  ìˆ˜ ìˆë‹¤.
	 */
    return validateRequest(request);
  }
}
```

User Roleì— ë”°ë¼ì„œ ë‹¤ë¥¸ ê²°ê³¼ë¥¼ ë³´ì—¬ì¤„ ìˆ˜ë„ ìˆë‹¤. admin ìœ ì €ë§Œì´ ì ‘ì†í•  ìˆ˜ ìˆëŠ” ê´€ë¦¬í˜ì´ì§€ì— ëŒ€í•´ì„œ  ì»¤ìŠ¤í…€ ë©”íƒ€ë°ì´í„°ë¥¼ ìƒì„±í•˜ì—¬ ìœ ì €ì˜ ì—­í• ì„ ê±°ë¥¼ ìˆ˜ë„ ìˆë‹¤. [Role-based authentication](https://docs.nestjs.com/guards#role-based-authentication)

### [Interceptors](https://docs.nestjs.com/interceptors)

`NestInterceptor` ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•˜ê³  `@Injectable` í•œ í´ë˜ìŠ¤ë¥¼ ì¸í„°ì…‰í„°ë¼ê³  ë¶€ë¦„. `ExecutionContext`(ì¤„ê¸°ì°¨ê²Œ ë´¤ë˜ê±°) + `CallHandler`(`handle`ì„ ì‚¬ìš©í•˜ì—¬ ë‹¤ìŒ ì»¨íŠ¸ë¡¤ëŸ¬ í•¸ë“¤ëŸ¬ë¥¼ ê°„ì ‘ í˜¸ì¶œ(RxJSë¥¼ ì‚¬ìš©í•œëŒ„ë‹¤))ë¥¼ í†µí•˜ì—¬ `intercept()` ë©”ì„œë“œë¥¼ êµ¬í˜„í•˜ë©´ ëœë‹¤. 

`CallHandler`ë¥¼ ì•„ì˜ˆ ê°ì‹¼ ê±¸ ë³´ë©´ request ~ response ë¡œì§ë³´ë‹¤ ìŠ¤ì½”í”„ê°€ ë„“ë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.

```typescript
import { Injectable, NestInterceptor, ExecutionContext, CallHandler } from '@nestjs/common';
import { Observable } from 'rxjs';
import { tap } from 'rxjs/operators';

@Injectable()
export class LoggingInterceptor implements NestInterceptor {
  intercept(context: ExecutionContext, next: CallHandler): Observable<any> {
    console.log('Before...');

    const now = Date.now();
    return next
      .handle() /** 
			     * handleì„ í˜¸ì¶œí•˜ëŠ” ê²ƒìœ¼ë¡œ request-response 
				 * handlerê°€ ì‹¤í–‰ëœë‹¤. í•¸ë“¤ëŸ¬ê°€ ë­˜ ìŠ¤íŠ¸ë¦¼ì— ë„£ëŠ”ì§€ëŠ”
				 * ì˜ ëª¨ë¥´ê² ë‹¤.
				 */
      .pipe(
		/**
		 * `tap`ì€ observable streamì´ ì •ìƒì ìœ¼ë¡œ (ì˜ˆì™¸ë„ í¬í•¨) 
		 * ì¢…ë£Œëì„ë•Œ ë°˜ì‘í•œë‹¤. 
		 */
        tap(() => console.log(`After... ${Date.now() - now}ms`)),
      );
  }
}
```

- **Binding Interceptors** with `@UseInterceptors(LoggingInterceptor)` for controller class & method
	- ì „ì—­ì ìœ¼ë¡œ ì¸í„°ì…‰í„°ë¥¼ ë“±ë¡í•˜ë ¤ë©´ `useGlobalInterceptors()`ë¥¼ ë¶€íŠ¸ìŠ¤íŠ¸ë© ë‹¨ê³„ì— ë„£ì–´ì£¼ì.
- **Response Mapping**
	- `handle()`ì´ [[#RxJS]]ì˜ `Observable` ê°ì²´ë¼ëŠ” ì‚¬ì‹¤ì„ ì•Œì•˜ìœ¼ë‹ˆ ì´ ìŠ¤íŠ¸ë¦¼ìœ¼ë¡œë¶€í„° ë¬´ì–¸ê°€ë¥¼ `map`í•  ìˆ˜ë„ ìˆë‹¤. ~~ì™„ì „ í•¨ìˆ˜í˜•ì¸ë°?~~
	- RxJSë¥¼ ì¢€ ë°°ì›Œì•¼ ì´í•´ê°€ ë  ë“¯ í•œë°, ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œëŠ” ì“¸ì§€ ëª¨ë¥´ê² ë‹¤.

## Outdated

- [[2023-11-13 {nest.js} {postgresql}]]
