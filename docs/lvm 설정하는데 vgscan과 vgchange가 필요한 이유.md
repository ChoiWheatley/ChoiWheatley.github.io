---
aliases: 
tags: 
description:
title: lvm 설정하는데 vgscan과 vgchange가 필요한 이유
created: 2024-09-16T21:34:20
updated: 2024-09-16T21:34:42
---

> [!question] 다음으로 vgscan 명령어를 치자 "volgroup0에 lvm2 타입 볼륨그룹을 찾았다"고 하더라고. 그리고 `vgchange -ay` 명령어로 앞서 생성했던 두개의 논리 볼륨 `lv_root`, `lv_home`을 활성화했다고 하네. 왜 이 작업이 필요한건지 설명해줘.

`vgscan`과 `vgchange -ay` 명령어를 사용하는 이유는 시스템이 부팅되었을 때, LVM으로 관리되는 볼륨 그룹과 그 안에 있는 논리 볼륨을 **인식하고 활성화**하기 위한 과정입니다. 이를 더 구체적으로 설명하겠습니다.

### 1. **`vgscan` 명령어의 역할**

`vgscan` 명령어는 시스템에서 **볼륨 그룹을 스캔**하여 LVM 볼륨 그룹을 찾고, 시스템이 그 정보를 인식하도록 해줍니다. 이 과정은 LVM 환경에서 디스크를 다시 인식하거나, 부팅 중 자동으로 볼륨 그룹을 인식하지 못했을 때 유용합니다.

- **목적**: `vgscan`은 시스템에 연결된 물리적 볼륨(PV)과 그 위에 설정된 볼륨 그룹(VG)을 다시 스캔하고 인식하여, 어떤 볼륨 그룹이 사용 가능한지 시스템에 알려줍니다.
- **결과**: 명령어 실행 후 `volgroup0`이라는 이름의 볼륨 그룹(LVM2 타입)이 발견되었다는 메시지를 출력한 것은, 시스템이 그 볼륨 그룹을 성공적으로 찾았다는 의미입니다.

### 2. **`vgchange -ay` 명령어의 역할**

`vgchange -ay` 명령어는 **볼륨 그룹과 그 안에 있는 논리 볼륨(LV)을 활성화**하는 데 사용됩니다. LVM에서 논리 볼륨은 처음 인식만 된 상태로는 사용할 수 없으며, 반드시 활성화 과정을 거쳐야 사용할 수 있습니다.

- **`-a` 옵션**: 이 옵션은 볼륨 그룹을 활성화(`y`는 yes)를 의미합니다. 이 과정을 통해 볼륨 그룹에 속한 모든 논리 볼륨이 활성화됩니다.
- **목적**: 논리 볼륨을 활성화하여 파일 시스템을 마운트하거나 사용자가 데이터를 읽고 쓸 수 있도록 만듭니다.

### 왜 이 과정이 필요한가?

1. **부팅 후 LVM 볼륨 인식 및 활성화**: 
   - 시스템이 처음 부팅될 때 LVM 볼륨 그룹이 자동으로 활성화되지 않는 경우가 있습니다. 이런 경우 수동으로 `vgscan`과 `vgchange -ay`를 실행하여 볼륨 그룹과 논리 볼륨을 활성화해야 합니다.
   - 예를 들어, RAID 구성, 복구 모드, 특정 서버 환경에서는 시스템이 자동으로 LVM을 인식하지 않을 수 있습니다.

2. **LVM 복구 및 재구성**:
   - LVM 시스템에서 문제가 발생했거나 디스크 구성을 다시 스캔해야 할 때 `vgscan`으로 볼륨 그룹을 다시 인식한 다음, `vgchange -ay`를 통해 활성화하여 복구하거나 접근할 수 있습니다.

3. **새로운 논리 볼륨 사용을 준비**:
   - 논리 볼륨을 생성한 후에도, 이 논리 볼륨을 시스템이 바로 사용할 수 있는 상태가 아닐 수 있습니다. `vgchange -ay` 명령어를 사용하여 논리 볼륨을 활성화한 후에야 파일 시스템을 마운트하거나 데이터를 쓸 수 있습니다.

### 요약

- **`vgscan`**: 시스템이 물리적 볼륨과 그 위의 볼륨 그룹을 인식할 수 있도록 스캔하는 과정.
- **`vgchange -ay`**: 논리 볼륨들을 활성화하여 실제로 파일 시스템을 마운트하고 데이터를 사용할 수 있도록 만드는 과정.

이 두 명령어는 LVM 볼륨 그룹과 논리 볼륨을 인식하고 사용할 수 있도록 활성화하는데 중요한 역할을 합니다.
