 ---
aliases: 
tags: 
description:
title: 8. Exceptional Control Flow
created: 2023-09-08T13:23:44
updated: 2023-09-08T16:29:12
---
- [[0121 CSAPP {swjungle}]]
___

프로세서의 컨트롤 플로 (Control Flow)는 PC의 값이 끊임없이 증가하며 해당 주소의 명령어를 읽는 과정을 의미. 모든 프로그램의 PC가 계속 1씩 증가하는 것은 아니잖아. 대표적으로 분기, 반복과 같은 jump가 있겠다. 이 경우 PC는 서로 인접하지 않은 두 주소 사이를 넘나드는 것이 가능하다.

하지만 분기나 반복의 경우, 프로그램 내부의 상태에 따라서만 PC를 옮기는 것이라는 점. ECF(Exceptional Control Flow)는 시스템의 상태변화에 따라서 PC를 옮기는 작업을 일컫는다. 대표적으로

- 패킷이 들어와 메모리 어딘가에 저장해야 하는 경우
- 디스크에 있는 파일을 불러오는 중이라서 메모리에 다 올릴때까지 대기할 수 없는 경우
- 하드웨어 타이머가 일정 인터벌을 넘겨버린 경우
- 자식 프로세스가 종료되기까지 기다려야 하는 경우

ECF는 여러종류가 있다. 하드웨어 단에서 발생한 이벤트를 처리하는 예외처리기 (exception handlers), OS 단에서 한 프로세스에서 다른 프로세스로 문맥전환(Context Switching), 유저 프로세스가 다른 프로세스에게 보내는 시그널이 있다. 이런 개별적인 프로그램들은 일반적인 실행흐름으로부터 벗어나 **side stepping**을 할 수도 있고, 또는 **nonlocal jump** 수행할 수도 있다.

ECF를 배워야 하는 이유는 다음과 같다.

- 중요한 시스템 컨셉 (IO, 프로세스, 가상메모리)를 이해하는데 사실상 필수로 알아야 하기 때문.
- 커널 코드에게 요청을 보내는 데 ECF를 사용하기 때문. (`trap` and `syscall`)
- 흥미로운 프로그램을 만드는 데 필요하기 때문. 셸을 만들어 셸 안에서 여러 다른 프로그램들을 실행시키고 그 결과를 받아봐야 하는 경우, 나만의 웹 서버를 만들고 싶은 경우
- concurrency 개념을 익히는 데에 아주 중요하기 때문.
- C++나 JAVA에서 제공하는 Software Exceptions를 이해하는 데 도움을 주기 때문. SW exception은 OS exception과 어떤 차이가 있는지, 유저 코드 안에서 nonlocal jump를 하기 위해 어떤 메커니즘이 들어가는지 알게된다.

예외는 하드웨어와 OS, 프로세스 간의 교차점을 알게 해준다. 시스템 콜로 하여금 OS와 유저 프로세스가 어떻게 상호작용 하는지에 대해 알아보고, 프로세스와 프로세스 간에 어떻게 상호작용 하는지에 대해 알아본다.

## DUMP

- [[⭐️ 8.1 Exceptions]]
- 8.2. Processes
- 8.3. System Call Error Handling
- 8.4. Process Control
- [[⭐️ 8.5. Signals]]
- 8.6. Nonlocal Jumps
- 8.7. Tools for Manipulating Processes
- 8.8. Summary
